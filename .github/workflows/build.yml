name: Android Build APK  
  
# Запуск на push или pull request в любую ветку  
on:  
  push:  
    branches:  
      - '**'   # любая ветка  
  pull_request:  
    branches:  
      - '**'  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
  
    steps:  
      # 1. Клонируем репозиторий  
      - name: Checkout repository  
        uses: actions/checkout@v3  
  
      # 2. Устанавливаем JDK (Java) и Android SDK  
      - name: Set up JDK  
        uses: actions/setup-java@v3  
        with:  
          distribution: 'temurin'  
          java-version: '17'  
  
      - name: Set up Android SDK  
        uses: android-actions/setup-android@v2  
        with:  
          api-level: 34  
          build-tools: '34.0.0'  
          ndk: '25.2.9519653'  
  
      # 3. Кэш Gradle и зависимости  
      - name: Cache Gradle  
        uses: actions/cache@v3  
        with:  
          path: |  
            ~/.gradle/caches  
            ~/.gradle/wrapper/  
          key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}  
          restore-keys: gradle-${{ runner.os }}-  
  
      # 4. Сборка APK  
      - name: Build APK  
        run: ./gradlew assembleRelease  
  
      # 5. Поиск APK в проекте  
      - name: Find APK  
        run: |  
          echo "Looking for APK..."  
          find . -type f -name "*.apk"  
  
      # 6. Сохраняем APK как артефакт  
      - name: Upload APK  
        uses: actions/upload-artifact@v4  
        with:  
          name: android-apk  
          path: '**/build/outputs/**/*.apk'